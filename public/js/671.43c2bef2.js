"use strict";(self["webpackChunkstarter_kit"]=self["webpackChunkstarter_kit"]||[]).push([[671],{88671:(t,e,n)=>{n.r(e),n.d(e,{default:()=>x});var s=n(56768),a=n(24232),r=n(45130),i={class:"admin-users"},l={key:0,class:"loading"},o={key:1,class:"users-table-container"},u={class:"users-table"},c={class:"actions"},d=["onClick","disabled"],p=["onClick","disabled"],v={class:"pagination"},g=["disabled"],k={class:"page-info"},b=["disabled"],h={key:2,class:"modal-overlay"},f={class:"modal"},m={class:"modal-body"},L={class:"modal-actions"};function A(t,e,n,A,C,S){var w;return(0,s.uX)(),(0,s.CE)("div",i,[e[7]||(e[7]=(0,s.Lk)("h1",null,"إدارة المستخدمين",-1)),C.loading?((0,s.uX)(),(0,s.CE)("div",l,"جاري تحميل المستخدمين...")):((0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("table",u,[e[5]||(e[5]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"ID"),(0,s.Lk)("th",null,"البريد الإلكتروني"),(0,s.Lk)("th",null,"تاريخ الإنشاء"),(0,s.Lk)("th",null,"عدد الرسائل"),(0,s.Lk)("th",null,"حالة الاشتراك"),(0,s.Lk)("th",null,"نهاية الاشتراك"),(0,s.Lk)("th",null,"الإجراءات")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(C.users,function(t){return(0,s.uX)(),(0,s.CE)("tr",{key:t.id},[(0,s.Lk)("td",null,(0,a.v_)(t.id),1),(0,s.Lk)("td",null,(0,a.v_)(t.email),1),(0,s.Lk)("td",null,(0,a.v_)(S.formatDate(t.createdAt)),1),(0,s.Lk)("td",null,(0,a.v_)(t.Device?t.Device.messagesCount:0),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,a.C4)(S.getSubscriptionStatusClass(t.Subscription))},(0,a.v_)(S.getSubscriptionStatus(t.Subscription)),3)]),(0,s.Lk)("td",null,(0,a.v_)(S.getSubscriptionEndDate(t.Subscription)),1),(0,s.Lk)("td",c,[t.Device?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:function(e){return S.deleteDevice(t.id)},class:"btn btn-danger",disabled:C.processingAction}," حذف الجهاز ",8,d)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:function(e){return S.showExtendModal(t)},class:"btn btn-primary",disabled:C.processingAction}," تجديد الاشتراك ",8,p)])])}),128))])]),(0,s.Lk)("div",v,[(0,s.Lk)("button",{onClick:e[0]||(e[0]=function(t){return S.changePage(C.currentPage-1)}),disabled:1===C.currentPage,class:"btn btn-secondary"}," السابق ",8,g),(0,s.Lk)("span",k," الصفحة "+(0,a.v_)(C.currentPage)+" من "+(0,a.v_)(C.totalPages),1),(0,s.Lk)("button",{onClick:e[1]||(e[1]=function(t){return S.changePage(C.currentPage+1)}),disabled:C.currentPage===C.totalPages,class:"btn btn-secondary"}," التالي ",8,b)])])),C.showModal?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("div",f,[(0,s.Lk)("h3",null,"تجديد الاشتراك للمستخدم "+(0,a.v_)(null===(w=C.selectedUser)||void 0===w?void 0:w.email),1),(0,s.Lk)("div",m,[e[6]||(e[6]=(0,s.Lk)("label",{for:"months"},"عدد الأشهر:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",id:"months","onUpdate:modelValue":e[2]||(e[2]=function(t){return C.extendMonths=t}),min:"1",max:"12",class:"form-input"},null,512),[[r.Jo,C.extendMonths,void 0,{number:!0}]])]),(0,s.Lk)("div",L,[(0,s.Lk)("button",{onClick:e[3]||(e[3]=function(){return S.extendSubscription&&S.extendSubscription.apply(S,arguments)}),class:"btn btn-primary"}," تجديد "),(0,s.Lk)("button",{onClick:e[4]||(e[4]=function(){return S.closeModal&&S.closeModal.apply(S,arguments)}),class:"btn btn-secondary"}," إلغاء ")])])])):(0,s.Q3)("",!0)])}var C=n(20908),S=n(30388),w=(n(28706),n(50113),n(23288),n(18111),n(20116),n(26099),n(37307));const P={name:"AdminUsers",data:function(){return{users:[],loading:!1,currentPage:1,pageSize:10,totalPages:0,totalUsers:0,showModal:!1,selectedUser:null,extendMonths:1,processingAction:!1}},mounted:function(){this.load()},methods:{load:function(){var t=this;return(0,S.A)((0,C.A)().m(function e(){var n,s,a,r;return(0,C.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return t.loading=!0,e.p=1,e.n=2,w.A.get("/api/admin/users?page=".concat(t.currentPage,"&limit=").concat(t.pageSize));case 2:n=e.v,s=n.data,s.success?(t.users=s.users,t.totalPages=s.totalPages,t.totalUsers=s.totalUsers):console.error("فشل في تحميل المستخدمين:",s.message),e.n=4;break;case 3:e.p=3,r=e.v,alert((null===(a=r.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)||r.message);case 4:return e.p=4,t.loading=!1,e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}))()},deleteDevice:function(t){var e=this;return(0,S.A)((0,C.A)().m(function n(){var s,a;return(0,C.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(confirm("هل أنت متأكد من حذف الجهاز؟")){n.n=1;break}return n.a(2);case 1:return e.processingAction=!0,n.p=2,n.n=3,w.A["delete"]("/api/admin/users/".concat(t,"/device"));case 3:alert("تم حذف الجهاز بنجاح"),e.load(),n.n=5;break;case 4:n.p=4,a=n.v,alert((null===(s=a.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.message)||a.message);case 5:return n.p=5,e.processingAction=!1,n.f(5);case 6:return n.a(2)}},n,null,[[2,4,5,6]])}))()},showExtendModal:function(t){this.selectedUser=t,this.extendMonths=1,this.showModal=!0},closeModal:function(){this.showModal=!1,this.selectedUser=null},extendSubscription:function(){var t=this;return(0,S.A)((0,C.A)().m(function e(){var n,s;return(0,C.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(t.selectedUser&&!(t.extendMonths<1)){e.n=1;break}return e.a(2);case 1:return t.processingAction=!0,e.p=2,e.n=3,w.A.post("/api/admin/users/".concat(t.selectedUser.id,"/subscription/extend"),{months:t.extendMonths});case 3:alert("تم تجديد الاشتراك بنجاح"),t.closeModal(),t.load(),e.n=5;break;case 4:e.p=4,s=e.v,alert((null===(n=s.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.message)||s.message);case 5:return e.p=5,t.processingAction=!1,e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])}))()},changePage:function(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.load())},formatDate:function(t){return new Date(t).toLocaleDateString("ar-EG")},getSubscriptionStatus:function(t){if(!t||0===t.length)return"لا يوجد اشتراك";var e=t.find(function(t){return"active"===t.status});return e?"نشط":"غير نشط"},getSubscriptionStatusClass:function(t){var e=this.getSubscriptionStatus(t);return"نشط"===e?"status-active":"status-inactive"},getSubscriptionEndDate:function(t){if(!t||0===t.length)return"غير متاح";var e=t.find(function(t){return"active"===t.status});return e?this.formatDate(e.endAt):"غير متاح"}}};var y=n(71241);const M=(0,y.A)(P,[["render",A],["__scopeId","data-v-7140a606"]]),x=M}}]);
//# sourceMappingURL=671.43c2bef2.js.map